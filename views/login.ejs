<!DOCTYPE html>  
<html> 
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

  <nav class="navbar navbar-inverse">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>                        
        </button>
        <a class="navbar-brand" href="#">Update 24x7 News</a>
      </div>
      <div class="collapse navbar-collapse" id="myNavbar">
        <ul class="nav navbar-nav">
          <li><a href="http://localhost:9001/home">Home</a></li>
          <li><a href="http://localhost:9001/sports">Sports</a></li>
          <li><a href="http://localhost:9001/aboutus">About</a></li>
          <li><a href="http://localhost:9001/contactus">Contact</a></li>
          <div class = "weather"><li style="text-align: center;"><p id="demo"></p></li></div>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li><a href="http://localhost:9002/index.html">Chat</a></li>
          <li><a href="http://localhost:9001/user/signup">Sign Up</a></li>
          <li class="active"><a href="#"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
        </ul>
      </div>
    </div>
  </nav>
  
      <meta charset="utf-8" />  
      <title>Update 24x7</title>  
      <style type="text/css">   
  
          .navbar {
        margin-bottom: 0;
        border-radius: 0;
      }
      
      /* Add a gray background color and some padding to the footer */
      footer {
        background-color: #f2f2f2;
        padding: 25px;
        position:absolute;
         bottom:0;
         width: 100%;
      }
  
          
  
      </style>  
<head>
    <h1>Login</h1>
</head>

<body style="text-align: center;">
    <form method="POST" action="/user/login" id="loginForm">
        <p>
            <label>Email</label>
            <input type="text" id="email" name="email" placeholder="Enter valid email." />
        </p>
        <p>
            <label>Password</label>
            <input type="password" id="password" name="password" placeholder="Enter valid password." />
        </p>
        <button>Login</button>
    </form>

    <button id="getUser">Get user info</button>

    <button id="logout">Logout</button>

    <p id="profile"></p>

    <script>

        const loginForm = document.getElementById("loginForm");

        loginForm.addEventListener("submit", (event) => {
            console.log(event);
            event.preventDefault();

            const email = document.getElementById("email").value
            const password = document.getElementById("password").value

            console.log(email, password)

            fetch("/user/login", {
                method: "POST",
                headers: {
                    "content-type": "application/json"
                },
                body: JSON.stringify({
                    email: email,
                    password: password
                })
            })
                .then((response) => {
                    return response.json()
                })
                .then((data) => {
                    localStorage.setItem("token", data.token);
                })
        })

        document.getElementById("getUser").addEventListener("click", ()=>{
            fetch("/user/whoami", {
                method: "POST",
                headers: {
                    "content-type": "application/json",
                    "x-access-token" : localStorage.getItem("token")
                }
            })
                .then((response) => {
                    return response.json()
                })
                .then((data) => {
                    document.getElementById("profile").innerHTML = JSON.stringify(data);
                })
        })

        document.getElementById("logout").addEventListener("click", ()=>{
            localStorage.removeItem("token");
        })

        
    </script>
</body>
<footer class="container-fluid text-center">
    <a href="http://localhost:9001/aboutus">Developed by team HISSS</a>
</footer>

</html>